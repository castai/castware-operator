image:
  repository: us-docker.pkg.dev/castai-hub/library/castware-operator
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion.
  tag: ""

leaderElection:
  enabled: true
  # Leader election resource lock type
  resourceLock: "leases"
  # Leader election resource name
  resourceName: "castware-operator-leader-election"

replicaCount: 1

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

namespace: "castai-agent"

serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

podAnnotations: {}

securityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: true
  capabilities:
    drop:
      - ALL

podSecurityContext:
  runAsNonRoot: true
  fsGroup: 1005
  runAsGroup: 1005
  runAsUser: 1005
  seccompProfile:
    type: RuntimeDefault


livenessProbe:
  httpGet:
    path: /healthz
    port: 8081
  initialDelaySeconds: 15
  periodSeconds: 20

readinessProbe:
  httpGet:
    path: /readyz
    port: 8081
  initialDelaySeconds: 5
  periodSeconds: 10

service:
  type: ClusterIP
  port: 80

resources: {}

# CRD installation
installCRDs: true

# CRD upgrade configuration
# This enables automatic CRD upgrade during helm upgrade operations
crdUpgrade:
  enabled: true
  image:
    repository: lachlanevenson/k8s-kubectl
    tag: "v1.25.4"
    pullPolicy: IfNotPresent

preflightCheck:
  enabled: true

# Webhook configuration
webhook:
  enabled: true
  port: 9443
  timeoutSeconds: 10

metrics:
  enabled: true

apiKeySecret:
  # Whether to create the API key secret
  create: true
  # Name of the secret (defaults to "castware-api-key")
  name: "castware-api-key"
  # The actual API key value (should be set via --set apiKeySecret.apiKey=YOUR_API_KEY)
  apiKey: ""

# Node affinity configuration
affinity:
  nodeAffinity:
    requiredDuringSchedulingIgnoredDuringExecution:
      nodeSelectorTerms:
        - matchExpressions:
            - key: kubernetes.io/os
              operator: NotIn
              values:
                - windows

# Whether to create the extended permissions for the operator, needed for Phase 2 components.
#
# When set to false (default - Phase 1):
#   - Standard read-only RBAC permissions
#   - Components from defaultComponents are installed:
#     * castai-agent: monitors cluster
#     * spot-handler: read-only mode (phase2Permissions: false)
#   - Components from defaultPhase2Components are NOT installed
#
# When set to true (Phase 2):
#   - Extended write RBAC permissions created (rbac-ext.yaml)
#   - Components from defaultComponents are installed:
#     * castai-agent: monitors cluster
#     * spot-handler: write mode (phase2Permissions: true automatically set)
#   - Components from defaultPhase2Components are installed (if defaultPhase2Components.enabled=true):
#     * cluster-controller: manages autoscaling
#
# Phase 2 installation example:
#   helm install castware-operator castai-helm/castware-operator \
#     -n castai-agent \
#     --set apiKeySecret.apiKey=<YOUR_API_KEY> \
#     --set extendedPermissions=true
#
# Install extended permissions without Phase 2 components (manual control):
#   helm install castware-operator castai-helm/castware-operator \
#     -n castai-agent \
#     --set apiKeySecret.apiKey=<YOUR_API_KEY> \
#     --set extendedPermissions=true \
#     --set defaultPhase2Components.enabled=false
#
extendedPermissions: false

# Default cluster configuration
defaultCluster:
  terraform: true
  enabled: true
  # This will create a default Cluster CR if enabled
  name: "castai"
  api:
    apiUrl: "https://api.cast.ai"
  # If not specified, will use apiKeySecret.name from above
  apiKeySecret: ""
  provider: ""
  helmRepoURL: "https://castai.github.io/helm-charts"

# Default components configuration (Phase 1)
#
# Phase 1 components are always created when defaultComponents.enabled=true:
#   - castai-agent: Monitors cluster state and reports to CAST AI
#   - spot-handler: Handles spot instance lifecycle events
#
# Note: spot-handler automatically switches to write mode (phase2Permissions: true)
#       when extendedPermissions=true is set.
#
defaultComponents:
  enabled: true
  # List of Phase 1 components to create
  # Each component will be created with the specified configuration
  components:
    castai-agent:
      component: "castai-agent"
      cluster: "castai"
      enabled: true
      # Optional: specify version (defaults to latest from CAST AI API)
      # version: "0.52.0"
      # Optional: custom Helm values
      # overrides:
      #   resources:
      #     limits:
      #       memory: "256Mi"
    spot-handler:
      component: "spot-handler"
      cluster: "castai"
      enabled: true
      # Optional: specify version (defaults to latest from CAST AI API)
      # version: "0.10.0"
      # Optional: custom Helm values
      # Note: phase2Permissions is automatically set based on extendedPermissions flag
      # overrides:
      #   resources:
      #     limits:
      #       memory: "512Mi"

# Default Phase 2 components configuration
#
# Phase 2 components are only created when:
#   1. defaultPhase2Components.enabled=true (default)
#   2. extendedPermissions=true
#
# Phase 2 components require extended RBAC permissions:
#   - cluster-controller: Manages cluster autoscaling and node operations
#
# Set defaultPhase2Components.enabled=false to install extended permissions
# without automatically installing Phase 2 components (useful for manual control).
#
defaultPhase2Components:
  enabled: true
  # List of Phase 2 components to create
  # Each component will be created with the specified configuration
  components:
    cluster-controller:
      component: "cluster-controller"
      cluster: "castai"
      enabled: true
      # Optional: specify version (defaults to latest from CAST AI API)
      # version: "0.40.0"
      # Optional: custom Helm values
      overrides:
        autoscaling:
          enabled: true
# -- Used to set additional volumes.
extraVolumes: []

# -- Used to set additional volume mounts.
extraVolumeMounts: []
