{{- if and .Values.defaultPhase2Components.enabled .Values.extendedPermissions }}
{{- range $name, $comp := .Values.defaultPhase2Components.components }}
{{- if $comp.enabled }}
---
apiVersion: castware.cast.ai/v1alpha1
kind: Component
metadata:
  name: {{ $name }}
  namespace: {{ $.Release.Namespace }}
  annotations:
    helm.sh/hook: post-install
    helm.sh/hook-delete-policy: hook-failed
    helm.sh/hook-weight: "20"
  labels:
    castware.cast.ai/phase: "phase2"
    {{- include "castware-operator.labels" $ | nindent 4 }}
spec:
  component: {{ $comp.component | quote }}
  cluster: {{ $comp.cluster | quote }}
  enabled: {{ $comp.enabled }}
  {{- if $comp.version }}
  version: {{ $comp.version | quote }}
  {{- end }}
  {{- if $comp.overrides }}
  values:
    {{- toYaml $comp.overrides | nindent 4 }}
  {{- end }}
{{- end }}
{{- end }}
{{- end }}
